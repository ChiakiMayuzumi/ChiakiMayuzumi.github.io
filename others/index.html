<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <title>Others - ChiakiMayuzumi</title>
    <meta name="generator" content="Hugo 0.15" />

    
    <meta name="description" content="A material design theme for documentations.">
    
    <link rel="canonical" href="http://chiakimayuzumi.github.io/others/">
    
    <meta name="author" content="ChiakiMayuzumi">
    

    <meta property="og:url" content="http://chiakimayuzumi.github.io/others/">
    <meta property="og:title" content="ChiakiMayuzumi">
    <meta property="og:image" content="http://chiakimayuzumi.github.io/images/cm.png">
    <meta name="apple-mobile-web-app-title" content="ChiakiMayuzumi">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="http://chiakimayuzumi.github.io/images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="http://chiakimayuzumi.github.io/images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('http://chiakimayuzumi.github.io/fonts/icon.eot?52m981');
        src: url('http://chiakimayuzumi.github.io/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
             url('http://chiakimayuzumi.github.io/fonts/icon.woff?52m981')
               format('woff'),
             url('http://chiakimayuzumi.github.io/fonts/icon.ttf?52m981')
               format('truetype'),
             url('http://chiakimayuzumi.github.io/fonts/icon.svg?52m981#icon')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="http://chiakimayuzumi.github.io/stylesheets/application.css">
    <link rel="stylesheet" href="http://chiakimayuzumi.github.io/stylesheets/temporary.css">
    <link rel="stylesheet" href="http://chiakimayuzumi.github.io/stylesheets/palettes.css">
    <link rel="stylesheet" href="http://chiakimayuzumi.github.io/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu%2bMono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <script src="http://chiakimayuzumi.github.io/javascripts/modernizr.js"></script>

    
    <link href="http://chiakimayuzumi.github.io/others/index.xml" rel="alternate" type="application/rss+xml" title="ChiakiMayuzumi" />
    <link href="http://chiakimayuzumi.github.io/others/index.xml" rel="feed" type="application/rss+xml" title="ChiakiMayuzumi" />
    

  </head>
  <body class="palette-primary-light red palette-accent-light green">


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Other
      </div>
    </div>

    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/ChiakiMayuzumi" title="@ChiakiMayuzumi on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="http://chiakimayuzumi.github.io/" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="http://chiakimayuzumi.github.io/images/cm.png">
        </div>
      
      <div class="name">
        <strong>ChiakiMayuzumi </strong>
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="博客目录" href="http://chiakimayuzumi.github.io/">
	
	博客目录
</a>


  
</li>



<li>
  
    



<a  title="联系方式" href="http://chiakimayuzumi.github.io/sketch/">
	
	联系方式
</a>


  
</li>


        </ul>
        

        
        <hr>
        <span class="section">The author</span>
        
        <ul>
          

          
          <li>
            <a href="https://github.com/ChiakiMayuzumi" target="_blank" title="@ChiakiMayuzumi on GitHub">
              @ChiakiMayuzumi on GitHub
            </a>
          </li>
          
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>Pages in Other</h1>

			
			<a href="http://chiakimayuzumi.github.io/others/setupwithviewpager/" title="setupWithViewPager()后到底发生了什么？">
				<h2>setupWithViewPager()后到底发生了什么？</h2>
			</a>

			<br>
			相信使用过 TabLayout 和 ViewPager 的人对这个方法一定不陌生了，当我们为 ViewPager 设置好 adapter 后，需要调用 TabLayout 的 setupWithViewPager 方法将 ViewPager 的引用传递进去： mViewPager.setAdapter(mAdapter); mTabLayout.setupWithViewPager(mViewPager); 那么接下来问题来了，为什么 setupWithViewPager 之后，ViewPager 和 TabLayout 就能关联起来呢？并且 ViewPager 设置的 adapter 中的 PageTitle数据就能正确反应到每一个 Tab 中去呢？为了搞明白这些背后的操作，我认为我们有必要去查看方法 setupWithViewPager 的源代码。 分析 setupWithViewPager() 的原理 方法源码 方法如下： public void setupWithViewPager(@Nullable final ViewPager viewPager) { if (mViewPager != null &amp;&amp; mPageChangeListener != null) { mViewPager.removeOnPageChangeListener(mPageChangeListener); } if (viewPager != null) { final PagerAdapter adapter = viewPager.getAdapter(); if (adapter == null) { throw new IllegalArgumentException(&quot;ViewPager does not have a PagerAdapter set&quot;); } mViewPager = viewPager; if (mPageChangeListener == null) { mPageChangeListener = new TabLayoutOnPageChangeListener(this); } mPageChangeListener.reset(); viewPager.addOnPageChangeListener(mPageChangeListener); setOnTabSelectedListener(new ViewPagerOnTabSelectedListener(viewPager)); setPagerAdapter(adapter, true); } else { mViewPager = null; setOnTabSelectedListener(null); setPagerAdapter(null, true); } } 先看第一部分： if (mViewPager != null &amp;&amp; mPageChangeListener != null) { mViewPager.removeOnPageChangeListener(mPageChangeListener); } 如果已经设置过 ViewPager 了，并且也设置了PageChangeListener，则将它移除。 再来第二部分： else { mViewPager = null; setOnTabSelectedListener(null); setPagerAdapter(null, true); } 如果传入了一个空的 ViewPager，就将 ViewPager，OnTabSelectedListener和PagerAdapter都设置为空。 然后是第三部分： if (viewPager != null) { final PagerAdapter adapter = viewPager.getAdapter(); if (adapter == null) { throw new IllegalArgumentException(&quot;ViewPager does not have a PagerAdapter set&quot;); } mViewPager = viewPager; if (mPageChangeListener == null) { mPageChangeListener = new TabLayoutOnPageChangeListener(this); } mPageChangeListener.reset(); viewPager.addOnPageChangeListener(mPageChangeListener); setOnTabSelectedListener(new ViewPagerOnTabSelectedListener(viewPager)); setPagerAdapter(adapter, true); } 如果 ViewPager 不为空，则将它赋值给 PagerAdapter 类型的引用 mViewPager。ViewPager 的 adapter 类型继承自 FragmentPagerAdapter，FragmentPagerAdapter 则是继承自 PagerAdapter，所以这样赋值是没有问题的。当adapter 为 null 抛出异常。 将这个传入的 ViewPager 引用赋值给类私有变量 mViewPager； 如果 TabLayoutOnPageChangeListener 为空，则新建一个 TabLayoutOnPageChangeListener ，调用 reset 方法，重设当前的滚动状态； 调用 ViewPager 的 addOnPageChangeListener 方法，设置监听：setOnTabSelectedListener(new ViewPagerOnTabSelectedListener(viewPager)); 最后设置setPagerAdapter(adapter, true)，整个方法就完成了， 第一个参数就是 ViewPager 设置的 adapter 后面的参数留到下一节观察者模式讲解。 两个监听的实现类 TabLayoutOnPageChangeListener 是一个监听，ViewPagerOnTabSelectedListener 是另一个监听。 先来看看 TabLayoutOnPageChangeListener。主要处理的是 ViewPager 发生变化时处理回调（尤其是需要实现跟 TabLayout 的关联，也就是说，当 ViewPager 在滑动时，TabLayout 需要怎么变化）。 它实现了 ViewPager.OnPageChangeListener 接口，需要实现三个方法： public void onPageScrolled(int position, float positionOffset, int positionOffsetPixels)，当当前页滚动时调用。 public void onPageSelected(int position)，当一个新页面被选中时调用。 重要方法：tabLayout.selectTab(tabLayout.getTabAt(position), updateIndicator) public void onPageScrollStateChanged(int state)，当滚动状态改变时调用。 重要方法：tabLayout.setScrollPosition(position, positionOffset, updateText, updateIndicator) 还有一个非接口实现方法 reset，该接口重新设置了滚动状态： private void reset() { mPreviousScrollState = mScrollState = SCROLL_STATE_IDLE; } 而 ViewPagerOnTabSelectedListener 跟上一个监听相反，主要处理的是当 TabLayout 中的 Tab 发生点击事件时，ViewPager 需要怎么变化。它实现的是TabLayout.OnTabSelectedListener 接口，需要实现三个方法： public void onTabSelected(Tab tab) public void onTabUnselected(Tab tab) public void onTabReselected(Tab tab) 在这里，只实现了第一个方法，源码如下： @Override public void onTabSelected(TabLayout.Tab tab) { mViewPager.setCurrentItem(tab.getPosition()); } 也就是当点击 TabLayout 的某个 tab 就将与之对应的那个 position 赋值给setCurrentItem 完成 ViewPager 的跳转。 最后总结一下 setupWithViewPager 是如何让 ViewPager 跟自身 TabLayout 产生关联的： 传入 ViewPager，为该 ViewPager 设监听 TabLayoutOnPageChangeListener，这样就使得 ViewPager 在滚动状态发生改变时，TabLayout 对应的有所改变 然后为TabLayout自身设置ViewPagerOnTabSelectedListener 当 TabLayout 点击状态发生改变时，ViewPager 也有相应改变。 最后，将 ViewPager 设置的 adapter 也设置给自己。 观察者模式的应用 继承关系 继承关系图如下： 分析 接下来开始分析 TabLayout 和 ViewPager 中用到的观察者模式。 PagerAdapter 是一个抽象类，其中包含有一个 DataSetObservable 和 DataSetObserver 的引用。 PagerAdapter 中重要的方法是 notifyDataSetChanged，当我们向 adapter 中增添数据后，都会调用这个方法。 public void notifyDataSetChanged() { synchronized (this) { if (mViewPagerObserver != null) { mViewPagerObserver.onChanged(); } } mObservable.notifyChanged(); } DataSetObservable 是 Observable 的具体实现类： public class DataSetObservable extends Observable&lt;DataSetObserver&gt; { public void notifyChanged() { synchronized(mObservers) { // since onChanged() is implemented by the app, it could do anything, including // removing itself from {@link mObservers} - and that could cause problems if // an iterator is used on the ArrayList {@link mObservers}.

			<hr>
			

			<aside class="copyright" role="note">
				
				&copy; 2016 Released under the MIT license &ndash;
				
				Documentation built with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				using the
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
			</aside>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = '';
      var repo_id  = '';
    
    </script>

    <script src="http://chiakimayuzumi.github.io/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;
            
            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }
        

        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }
    </script>

    

    <script src="//gohugo.io/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>
